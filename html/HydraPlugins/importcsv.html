<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Import CSV files &mdash; HYDRA  documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="HYDRA  documentation" href="../index.html" />
    <link rel="up" title="Hydra Apps" href="index.html" />
    <link rel="next" title="Export to CSV files" href="exportcsv.html" />
    <link rel="prev" title="Hydra Apps" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="exportcsv.html" title="Export to CSV files"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Hydra Apps"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">HYDRA  documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Hydra Apps</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Import CSV files</a><ul>
<li><a class="reference internal" href="#basics">Basics</a></li>
<li><a class="reference internal" href="#options">Options</a></li>
<li><a class="reference internal" href="#file-structure">File structure</a><ul>
<li><a class="reference internal" href="#todo">TODO</a></li>
</ul>
</li>
<li><a class="reference internal" href="#building-a-windows-executable">Building a windows executable</a></li>
<li><a class="reference internal" href="#api-docs">API docs</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Hydra Apps</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="exportcsv.html"
                        title="next chapter">Export to CSV files</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/HydraPlugins/importcsv.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-ImportCSV">
<span id="import-csv-files"></span><span id="importcsv"></span><h1>Import CSV files<a class="headerlink" href="#module-ImportCSV" title="Permalink to this headline">¶</a></h1>
<p>A Hydra plug-in for importing CSV files.</p>
<div class="section" id="basics">
<h2>Basics<a class="headerlink" href="#basics" title="Permalink to this headline">¶</a></h2>
<p>The plug-in for importing CSV files assumes that you have a collection of files
ready. You need one or several files for nodes (usually one file per node type)
and files for links (usually on file per link type). One node file and one link
file are mandatory, additional files are optional. The plug-in also allows you
to import network attributes.</p>
<p>Basic usage:</p>
<div class="highlight-python"><div class="highlight"><pre>ImportCSV.py [-h] [-p PROJECT] [-s SCENARIO] [-t NETWORK]
             -n NODES [NODES ...] -l LINKS [LINKS ...]
             [-r RULES [RULES ...]] [-z TIMEZONE]
             [-g GROUPS] [-k GROUPMEMBERS]
             [-t TEMPLATE]
             [-u SERVER=URL] [-c SESSION-ID]
             [-x]
</pre></div>
</div>
</div>
<div class="section" id="options">
<h2>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="8%" />
<col width="15%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Short</th>
<th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">--help</span></tt></td>
<td><tt class="docutils literal"><span class="pre">-h</span></tt></td>
<td>&nbsp;</td>
<td>show help message and exit.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">--project</span></tt></td>
<td><tt class="docutils literal"><span class="pre">-p</span></tt></td>
<td>PROJECT</td>
<td>The ID of an existing project. If no
project is specified or if the ID
provided does not belong to an existing
project, a new one will be created.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">--scenario</span></tt></td>
<td><tt class="docutils literal"><span class="pre">-s</span></tt></td>
<td>SCENARIO</td>
<td>Specify the name of the scenario
created by the import function. Every
import creates a new scenario. If no
name is provided a default name will be
assigned.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">--network</span></tt></td>
<td><tt class="docutils literal"><span class="pre">-t</span></tt></td>
<td>NETWORK</td>
<td>Specify the file containing network
information. If no file is specified, a
new network will be created using
default values.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">--network_id</span></tt></td>
<td><tt class="docutils literal"><span class="pre">-i</span></tt></td>
<td>NETWORK_ID</td>
<td>Specify the ID of the network to be
updated, if not specified,a new network
will be created.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">--nodes</span></tt></td>
<td><tt class="docutils literal"><span class="pre">-n</span></tt></td>
<td>NODES</td>
<td>One or multiple files containing nodes
and attributes.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">--links</span></tt></td>
<td><tt class="docutils literal"><span class="pre">-l</span></tt></td>
<td>LINKS</td>
<td>One or multiple files containing
information on links.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">--groups</span></tt></td>
<td><tt class="docutils literal"><span class="pre">-g</span></tt></td>
<td>GROUPS</td>
<td>A file or list of files containing
group name, description,
attributes and data.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">--groupmembers</span></tt></td>
<td><tt class="docutils literal"><span class="pre">-k</span></tt></td>
<td>MEMBERS</td>
<td>A file or list of files containing
group members.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">--template</span></tt></td>
<td><tt class="docutils literal"><span class="pre">-m</span></tt></td>
<td>TEMPLATE</td>
<td>XML file defining the types for the
network. Required if types are set.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">--rules</span></tt></td>
<td><tt class="docutils literal"><span class="pre">-l</span></tt></td>
<td>RULES</td>
<td>File(s) containing rules or constraints
as mathematical expressions.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">--timezone</span></tt></td>
<td><tt class="docutils literal"><span class="pre">-z</span></tt></td>
<td>TIMEZONE</td>
<td>Specify a timezone as a string
following the Area/Loctation pattern
(e.g.  Europe/London). This timezone
will be used for all timeseries data
that is imported. If you don&#8217;t specify
a timezone, it defaults to UTC.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">--expand-filenames</span></tt></td>
<td><tt class="docutils literal"><span class="pre">-x</span></tt></td>
<td>&nbsp;</td>
<td>If the import function encounters
something that looks like a filename,
it tries to read the file.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">--server-url</span></tt></td>
<td><tt class="docutils literal"><span class="pre">-u</span></tt></td>
<td>SERVER-URL</td>
<td>Url of the server the plugin will
connect to.
Defaults to localhost.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">--session-id</span></tt></td>
<td><tt class="docutils literal"><span class="pre">-c</span></tt></td>
<td>SESSION-ID</td>
<td>Session ID used by the callig software.
If left empty, the plugin will attempt
to log in itself.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="file-structure">
<h2>File structure<a class="headerlink" href="#file-structure" title="Permalink to this headline">¶</a></h2>
<p>In the node and link file a minimum of information has to be provided in order
to be able to import a complete network. Optionally the files can define any
number of attributes for nodes and links.</p>
<p>For nodes a valid file looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre>Name , x, y, type, attribute_1, attribute_2, ..., attribute_n, description
Units,  ,  ,     ,           m,    m^3 s^-1, ...,           -,
node1, 2, 1, irr ,         4.0,      3421.9, ...,  Crop: corn, Irrigation 1
node2, 2, 3, irr ,         2.4,       988.4, ...,  Crop: rice, Irrigation 2
</pre></div>
</div>
<p>For links, the following is a valid file:</p>
<div class="highlight-python"><div class="highlight"><pre>Name ,       from,       to, type, attre_1, ...,  attre_n, description
Units,           ,         ,     ,       m, ..., m^2 s^-1,
link1,      node1,    node2, tran,     453, ...,     0.34, Water transfer
</pre></div>
</div>
<p>It is optional to supply a network file. If you decide to do so, it needs to
follow this structure:</p>
<div class="highlight-python"><div class="highlight"><pre># A test network created as a set of CSV files
ID, Name            , type, attribute_1, ..., Description
Units,              ,     ,            ,    ,
1 , My first network, net , test       ,    , Network created from CSV files
</pre></div>
</div>
<p>Constraint groups come in 2 files.
The first file defines the name, description and attributes of a file and looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre>Name  , attribute_1, attribute_2..., Description
Units , hm^3       , m             ,
stor  , totalCap   , maxSize       , Storage nodes
...   , ...        , ...           , ...
</pre></div>
</div>
<p>The second file defines the members of the groups.
The group name, the type of the member (node, link or another group) and the name
of that other member are needed:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Name</span>  <span class="p">,</span> <span class="n">Type</span>  <span class="p">,</span> <span class="n">Member</span>
<span class="n">stor</span>  <span class="p">,</span> <span class="n">NODE</span>  <span class="p">,</span> <span class="n">node1</span>
<span class="n">stor</span>  <span class="p">,</span> <span class="n">NODE</span>  <span class="p">,</span> <span class="n">node2</span>
<span class="n">stor</span>  <span class="p">,</span> <span class="n">LINK</span>  <span class="p">,</span> <span class="n">link1</span>
</pre></div>
</div>
<p>Metadata can also be included in separate files, which are <strong>named the same
as the node/link file, but with _metadata at the end.</strong></p>
<dl class="docutils">
<dt>For example:</dt>
<dd>nodes.csv becomes nodes_metadata.csv
network.csv becomes network_metadata.csv
my_urban_links.csv becomes my_urban_links_metadata.csv</dd>
</dl>
<p>Metadata files are structured as follows:</p>
<blockquote>
<div>Name  , attribute_1             , attribute_2             , attribute_3
link1 , (key1:val1) (key2:val2) , (key3:val3) (key4:val4) , (key5:val5)</div></blockquote>
<p>In this case, key1 and key2 are metadata items for attribute 1 and so on.
The deliminator for the key-val can be &#8216;;&#8217; or &#8216;:&#8217;. Note that all key-val
pairs are contained within &#8216;(...)&#8217;, with a space between each one. This way
you can have several metadata items per attribute.</p>
<p>Lines starting with the <tt class="docutils literal"><span class="pre">#</span></tt> character are ignored.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you specify a header line using the keywords <tt class="docutils literal"><span class="pre">name</span></tt>, <tt class="docutils literal"><span class="pre">x</span></tt>, <tt class="docutils literal"><span class="pre">y</span></tt> and
<tt class="docutils literal"><span class="pre">description</span></tt> (<tt class="docutils literal"><span class="pre">name</span></tt>, <tt class="docutils literal"><span class="pre">from</span></tt>, <tt class="docutils literal"><span class="pre">to</span></tt> and <tt class="docutils literal"><span class="pre">description</span></tt> for links)
the order of the columns does not matter. If you don&#8217;t specify these
keywords, the plug-in will assume that the first column specifies the name,
the second X, the third Y and the last the description (name, from, to and
description for links).</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">type</span></tt> column is optional.</p>
</div>
<p>Please also consider the following:</p>
<ul class="simple">
<li>A link references to start and end node by name. This also implies that the  node names defined in the file need to be unique.</li>
<li>The description should be in the last column. This will lead to more readable  files, since the description is usually free form text.</li>
<li>If you specify more than one file containing nodes, common attributes (i.e.  with the same name) will be considered the same. This results in a unique  attribute set for nodes. The same applies for links.</li>
<li>An attribute to a node or link is only added if there is a value for that  specific attribute in the line specifying a node (or link). If an attribute  should be added as a variable, you need to enter <tt class="docutils literal"><span class="pre">NULL</span></tt>.</li>
<li>If you use a tmplate during import, missing attributes will be added to each  node or link according to its type.</li>
</ul>
<div class="section" id="todo">
<h3>TODO<a class="headerlink" href="#todo" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Implement updating of existing scenario.</li>
</ul>
</div>
</div>
<div class="section" id="building-a-windows-executable">
<h2>Building a windows executable<a class="headerlink" href="#building-a-windows-executable" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li>Use pyinstaller (pip install pyisntaller) to build a windows executable.</li>
<li>cd to the $PATH_TO_HYDRA/HydraPlugins/CSVPlugin/trunk</li>
<li>pyinstaller -F ImportCSV.py</li>
<li>If you want more compression (a smaller exe), install upx and run pyinstaller -F &#8211;upx-dir=/path/to/upx/dir ExportCSV.py</li>
<li>An executable file will appear in the dist folder</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="api-docs">
<h2>API docs<a class="headerlink" href="#api-docs" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="ImportCSV.ImportCSV">
<em class="property">class </em><tt class="descclassname">ImportCSV.</tt><tt class="descname">ImportCSV</tt><big>(</big><em>url=None</em>, <em>session_id=None</em><big>)</big><a class="headerlink" href="#ImportCSV.ImportCSV" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="ImportCSV.ImportCSV.add_data">
<tt class="descname">add_data</tt><big>(</big><em>resource</em>, <em>attrs</em>, <em>data</em>, <em>metadata</em>, <em>units=None</em>, <em>restrictions={}</em><big>)</big><a class="headerlink" href="#ImportCSV.ImportCSV.add_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Add the data read for each resource to the resource. This requires
creating the attributes, resource attributes and a scenario which holds
the data.</p>
</dd></dl>

<dl class="method">
<dt id="ImportCSV.ImportCSV.check_header">
<tt class="descname">check_header</tt><big>(</big><em>file</em>, <em>header</em><big>)</big><a class="headerlink" href="#ImportCSV.ImportCSV.check_header" title="Permalink to this definition">¶</a></dt>
<dd><p>Check for common mistakes in headers:
Duplicate columns
Empty columns</p>
</dd></dl>

<dl class="method">
<dt id="ImportCSV.ImportCSV.create_attribute">
<tt class="descname">create_attribute</tt><big>(</big><em>name</em>, <em>unit=None</em><big>)</big><a class="headerlink" href="#ImportCSV.ImportCSV.create_attribute" title="Permalink to this definition">¶</a></dt>
<dd><p>Create attribute locally. It will get added in bulk later.</p>
</dd></dl>

<dl class="method">
<dt id="ImportCSV.ImportCSV.get_file_data">
<tt class="descname">get_file_data</tt><big>(</big><em>file</em><big>)</big><a class="headerlink" href="#ImportCSV.ImportCSV.get_file_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Taking a csv file as an argument,
return an array where each element is a line in the csv.</p>
</dd></dl>

<dl class="method">
<dt id="ImportCSV.ImportCSV.get_metadata_as_dict">
<tt class="descname">get_metadata_as_dict</tt><big>(</big><em>keys</em>, <em>metadata</em><big>)</big><a class="headerlink" href="#ImportCSV.ImportCSV.get_metadata_as_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Turn a list of metadata values into a dictionary structure.
&#64;parameter keys to describe the attribte to which this metadata refers
&#64;parameter list of metadata. in the structure: [&#8220;(key;val) (key;val)&#8221;, &#8220;(key;val) (key;val)&#8221;,...]
&#64;returns dictionary in the format: {attr1 : {key:val, key:val}, attr2: {key:val, key:val}...}</p>
</dd></dl>

<dl class="method">
<dt id="ImportCSV.ImportCSV.read_group_members">
<tt class="descname">read_group_members</tt><big>(</big><em>file</em><big>)</big><a class="headerlink" href="#ImportCSV.ImportCSV.read_group_members" title="Permalink to this definition">¶</a></dt>
<dd><p>The heading of a group file looks like:
name, type, member.</p>
<p>name : Name of the group
type : Type of the member (node, link or group)
member: name of the node, link or group in question.</p>
</dd></dl>

<dl class="method">
<dt id="ImportCSV.ImportCSV.read_groups">
<tt class="descname">read_groups</tt><big>(</big><em>file</em><big>)</big><a class="headerlink" href="#ImportCSV.ImportCSV.read_groups" title="Permalink to this definition">¶</a></dt>
<dd><p>The heading of a group file looks like:
name, attr1, attr2..., description</p>
</dd></dl>

<dl class="method">
<dt id="ImportCSV.ImportCSV.return_xml">
<tt class="descname">return_xml</tt><big>(</big><big>)</big><a class="headerlink" href="#ImportCSV.ImportCSV.return_xml" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a fist version of a possible XML output.</p>
</dd></dl>

</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="exportcsv.html" title="Export to CSV files"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Hydra Apps"
             >previous</a> |</li>
        <li><a href="../index.html">HYDRA  documentation</a> &raquo;</li>
          <li><a href="index.html" >Hydra Apps</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Halcrow and University College London.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>
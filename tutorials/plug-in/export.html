<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>4. Exporting the Network &mdash; HydraPlatform  documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="HydraPlatform  documentation" href="../../index.html" />
    <link rel="up" title="App development" href="index.html" />
    <link rel="next" title="5. Parsing the Arguments" href="parsing_arguments.html" />
    <link rel="prev" title="3. Connecting to Hydra Platform" href="connecting.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="exporting-the-network">
<h1>4. Exporting the Network<a class="headerlink" href="#exporting-the-network" title="Permalink to this headline">Â¶</a></h1>
<p>To export the function, we need 1 pieces of information, the ID of the nework.
The ID of the scenario within the network is not strictly necessary nor is the
folder where you want the file to end up. If you do not specify either of these,
all the scenarios will be exported, and the file will save to the desktop.</p>
<p>As we are using a JSON connection, the network is returned as a JSON object.
We can therefore just convert this to a string and send it to the file. No
parsing needed!</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network_id</span><span class="p">,</span> <span class="n">scenario_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">target_dir</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export a network in Hydra as a .json file</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c">#Will print !!Output Retrieving Network</span>
    <span class="n">write_output</span><span class="p">(</span><span class="s">&quot;Retrieving Network&quot;</span><span class="p">)</span>
    <span class="c">#Will print !!Progress 2/3</span>
    <span class="n">write_progress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_steps</span><span class="p">)</span>

    <span class="c">#Some basic error checking.</span>
    <span class="k">if</span> <span class="n">network_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c">#The network ID can be specified to get the network...</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c">#Get the nework using the connection&#39;s &#39;call&#39; function.</span>
            <span class="c">#This returns the network as a JSON dictionary. Handy that!</span>
            <span class="k">if</span> <span class="n">scenario_id</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s">&#39;get_network&#39;</span><span class="p">,</span>
                                              <span class="p">{</span><span class="s">&#39;network_id&#39;</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">network_id</span><span class="p">)})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s">&#39;get_network&#39;</span><span class="p">,</span>
                                              <span class="p">{</span><span class="s">&#39;network_id&#39;</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">network_id</span><span class="p">),</span>
                                              <span class="s">&#39;scenario_ids&#39;</span><span class="p">:[</span><span class="nb">int</span><span class="p">(</span><span class="n">scenario_id</span><span class="p">)]})</span>

            <span class="n">write_output</span><span class="p">(</span><span class="s">&quot;Network retrieved&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HydraPluginError</span><span class="p">(</span><span class="s">&quot;Network </span><span class="si">%s</span><span class="s"> not found.&quot;</span><span class="o">%</span><span class="n">network_id</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HydraPluginError</span><span class="p">(</span><span class="s">&quot;A network ID must be specified!&quot;</span><span class="p">)</span>

    <span class="c">#Default to $HOME/Desktop</span>
    <span class="k">if</span> <span class="n">target_dir</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">target_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s">&#39;~&#39;</span><span class="p">),</span> <span class="s">&#39;Desktop&#39;</span><span class="p">)</span>

    <span class="c">#If the target folder doesn&#39;t exist, create it.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">target_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">target_dir</span><span class="p">)</span>

    <span class="c">#Write the network</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write_network</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">target_dir</span><span class="p">)</span>
</pre></div>
</div>
<p>Once we have the network retrieved, save it to a file:
Note that the name of the file is derived from the name of the network.
As the network is a JSON dictionary, its name is accessed by doing <code class="docutils literal"><span class="pre">network['name']</span></code>.
All the properties of the network can be listed by doing <code class="docutils literal"><span class="pre">network.keys()</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">write_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">,</span> <span class="n">target_dir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write a JSON-based network to a file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">write_output</span><span class="p">(</span><span class="s">&quot;Writing network to file&quot;</span><span class="p">)</span>
    <span class="n">write_progress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_steps</span><span class="p">)</span>

    <span class="n">file_name</span> <span class="o">=</span> <span class="s">&quot;network_</span><span class="si">%s</span><span class="s">.json&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">network</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>

    <span class="c">#To show to the user when the plugin is finished.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">target_dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">))</span>

    <span class="c">#os.path.join ensures cross-platform compatibility.</span>
    <span class="n">network_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">target_dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">),</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>

    <span class="c">#Json.dumps turns a JSON dict into a string</span>
    <span class="c">#Put ins some formatting to make the file easier to read</span>
    <span class="n">network_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="s">&#39;: &#39;</span><span class="p">)))</span>

    <span class="n">write_output</span><span class="p">(</span><span class="s">&quot;Network Written to </span><span class="si">%s</span><span class="s"> &quot;</span><span class="o">%</span><span class="p">(</span><span class="n">target_dir</span><span class="p">))</span>
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">HydraPlatform</a></h1>





<p>
<iframe src="https://ghbtns.com/github-btn.html?user=UMWRG&repo=HydraPlatform&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>


<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Tutorials</a><ul>
  <li><a href="index.html">App development</a><ul>
      <li>Previous: <a href="connecting.html" title="previous chapter">3. Connecting to Hydra Platform</a></li>
      <li>Next: <a href="parsing_arguments.html" title="next chapter">5. Parsing the Arguments</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../plugins/index.html">Apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../design/index.html">Design</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../getting-started/index.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webservice/index.html">HydraPlatform web service</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">App development</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="index.html#general-concepts">General concepts</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html#developing-an-app-in-python">Developing an app in Python</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="setup.html">1. Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="imports.html">2. Imports</a></li>
<li class="toctree-l4"><a class="reference internal" href="connecting.html">3. Connecting to Hydra Platform</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="">4. Exporting the Network</a></li>
<li class="toctree-l4"><a class="reference internal" href="parsing_arguments.html">5. Parsing the Arguments</a></li>
<li class="toctree-l4"><a class="reference internal" href="run.html">6. Running the Code</a></li>
<li class="toctree-l4"><a class="reference internal" href="documentation.html">7. Documentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="templates.html">8. Working with templates</a></li>
<li class="toctree-l4"><a class="reference internal" href="integration.html">9. Integrating the plug-in into Hydra Modeller</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../using-templates/index.html">Building HydraPlatform templates</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../implementation/index.html">Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../webapi/index.html">Web API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devdocs/index.html">Developers documentation</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, CH2M Hill Halcrow and The University of Manchester.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
      |
      <a href="../../_sources/tutorials/plug-in/export.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/UMWRG/HydraPlatform" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>